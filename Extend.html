<html>
    <head>
        <style type="text/css">
            *
            {
                border: 0;
                margin: 0;
                padding: 0;
                overflow: hidden;
                -moz-user-select: none;
                -webkit-user-select: none;
                -ms-user-select:none;
                user-select:none;
            }
            
            .view_container > *, #container
            {
                position: absolute;
                top: 0;
                left: 0;
            }
            
            .view_container > div
            {
                z-index: 3;
                width: 100%;
                height: 100%;
            }
            
            #container
            {
                width: 100%;
                height: 100%;
            }
            
            .view_container
            {
                position: absolute;
                display: none;
            }
        </style>
    </head>
    <body>
        <div id="container">
            <canvas id="gameboard" width="1000" height="500">
                I realise it is non-portable, but this page requires &lt;canvas&gt; and JavaScript, sorry.
            </canvas>
            <div class="view_container" style="width: 200px; height: 200px; display: block; top: 100px; left: 100px;">
                <canvas id="eee" width="200" height="200">
                    I realise it is non-portable, but this page requires &lt;canvas&gt; and JavaScript, sorry.
                </canvas>
                <div>
                </div>
            </div>
        </div>
        <script type="text/javascript" src="Extend.js"></script>
        <script type="text/javascript" src="Utils/Container.js"></script>
        <script type="text/javascript" src="Widgets/Widget.js"></script>
        <script type="text/javascript" src="Widgets/Button.js"></script>
        <script type="text/javascript">
        
        function Bla(_child, _d)
        {
            this.H = function (a, b)
            {
                console.log('' + a + ', ' + b + ', ' + _d);
            }
            var G = function (a, b)
            {
                this.H(a, b);
            }
            
            this.F = function ()
            {
                _child.H.apply(_child, [1, 2]);
            }
        }
        
        var t0 = new Bla(0, 46);
        var t1 = new Bla(t0, 42);
        t1.F();
        
        
        function Every(_ms, _init, _catchup)
        {
            _init    = _init    !== false;
            _catchup = _catchup !== false;
            
            var _cur = 0;
            var ret = function (add)
                {
                    _cur += add;
                    if (_init)
                    {
                        _init = false;
                        return true;
                    }
                    else if (_cur >= _ms)
                    {
                        if (_catchup) _cur -= _ms;
                        else _cur = 0;
                        return true;
                    }
                    return false;
                };
            
            ret.Reset = function ()  { _cur = 0;    };
            ret.Get   = function ()  { return _cur; };
            ret.Add   = function (s) { _cur += s;   };
            
            return ret;
        }
        
        var canvas = document.getElementById('gameboard').getContext('2d');
        
        var Animal = function (a)
        {
            console.log('' + a);
            this.Hi = function () { console.log('Animal.Hi'); }
        }
        Object.specify(Animal, new Interface (['Hi']));
        Animal.prototype.Yo = function () { console.log('Animal.Yo'); }
        
            /*new Interface ({
                Hi: Interface.FUNCTION,
                VARR: Interface.VAR,
                YEAH: Interface.CONST
            }));*/
        
        var Cat = Object.inherit(function (x)
            {
                console.log('a');
                this.super(x);
                console.log('b');
            }, Animal);
        
        Cat.prototype.Hi = function () { console.log('Cat.Hi'); }
        
        var aa = new Cat(44);
        var bb = new Animal(45);
        
        aa.Yo();
        aa.Hi();
        bb.Yo();
        bb.Hi();
        //Animal.prototype.Hi.apply(aa);
        //Cat.base.Hi.apply(aa);
        var b = Cat.VARR;
        var c = Cat.YEAH;
        
        
        function ASSERT(x) { if (x) console.log('PASS'); else console.log('FAIL'); }
        
        function Square(_x, _y, _colour)
        {
            "use strict";
            var _last = Every(1000);
            
            this.super(_x, _y);
            
            this.Render = function (ctx, time, force)
            {
                if (_last(time) || force) // Order is important.
                {
                    var gradient = ctx.createLinearGradient(0, 0, ctx.width, 0);
                    // Add the colors with fixed stops at 1/4 of the width.
                    gradient.addColorStop(0.0 , 'magenta');
                    gradient.addColorStop(0.25, 'blue');
                    gradient.addColorStop(0.50, 'green');
                    gradient.addColorStop(0.75, 'yellow');
                    gradient.addColorStop(1.0 , 'red');
                    
                    // Use the gradient.
                    ctx.fillStyle = gradient;
                    ctx.fillRect(0, 0, ctx.width / 2, ctx.height / 2);
                    ctx.fillRect(ctx.width / 2, ctx.height / 2, ctx.width / 2, ctx.height / 2);
                    //ctx.fillRect(250, 300, 600, 500);
                    //ctx.fillStyle = 'skyblue';
                    //ctx.fillRect(0, 0, ctx.width, ctx.height);
                    _last = time;
                    return true;
                }
                return false;
            };
            return this;
        }
        
        
        Object.inherit(Square, Widget);
        
        
        //w = new Widget(0, -10, -10);
        w = new Square(0, 0);
        ASSERT(w.X == 0);
        ASSERT(w.Y == 0);
        w.Width = 600;
        w.Height = 600;
        //console.log('1');
        ASSERT(w.Width == 600);
        //console.log('1');
        ASSERT(w.Height == 600);
        
        //<!-- w._Render(canvas, 10, 10, 20, 20, 60, 60, 10000, true); -->
        x = new Square(200, 200);
        x.Width = 300;
        x.Height = 300;
        
        y = new Square(100, 100);
        y.Width = 150;
        y.Height = 150;
        
        z = new Square(50, 50);
        z.Width = '100%';
        z.Height = 75;
        
        y.AddWidget(z);
        w.AddWidget(y);
        w.AddWidget(x);
        //y.AddWidget(z);
        
        var view = new Viewport();
        
        
        var Fancy = Inherit(function (x, y)
            {
                this.super(x, y);
                this.RenderDown = function (ctx, time)
                    {
                        console.log('down');
                        console.log('down');
                    };
                this.RenderUp = function (ctx, time)
                    {
                        console.log('up');
                        console.log('up');
                    };
                this.Width = 100;
                this.Height = 100;
            }, Button);
        
        
        
        
        
        qq = new GreyButton3D(0, 10);
        
        qq.Align = 'center';
        x.Z = 1;
        
        function DragTarget()
        {
            this.Render = function (ctx, time, force)
            {
                
            };
        };
        
        Inherit(DragTarget, Widget);
        
        
        
        var BoringWindow = Inherit(function (x, y)
            {
                this.super(x, y);
                
                /*this.RenderChrome = function (ctx, time, force)
                {
                    if (force)
                    {
                        var w = ctx.width;
                        var h = ctx.height;
                        ctx.fillStyle = 'lightgray';
                        ctx.fillRect(0, 0, w, h);
                        
                        ctx.strokeStyle = 'black';
                        ctx.beginPath();
                        ctx.moveTo(w - 1, 1);
                        ctx.lineTo(w - 1, h - 1);
                        ctx.lineTo(1, h - 1);
                        ctx.moveTo(2, h - 2);
                        ctx.lineTo(w - 2, h - 2);
                        ctx.lineTo(w - 2, 2);
                        ctx.stroke();
                        
                        ctx.strokeStyle = 'white';
                        ctx.beginPath();
                        ctx.moveTo(w - 1, 0);
                        ctx.lineTo(0, 0);
                        ctx.lineTo(0, h - 1);
                        ctx.moveTo(1, h - 2);
                        ctx.lineTo(1, 1);
                        ctx.lineTo(w - 2, 1);
                        ctx.stroke();
                        
                        ctx.fillStyle = 'white';
                        ctx.fillRect(5, 35, w - 10, h - 40);
                        
                        ctx.fillStyle = 'blue';
                        ctx.fillRect(5, 5, w - 10, 27);
                        //this.Chrome().FoldL('_Render', force, [ctx, x, y, 0, 0, w, h, time]);
                    }
                };*/
                
                this.RegisterAction('click');
                
                this.GetViewport = function (w, h)
                {
                    return {l: 5, t: 35, r: w - 5, b: h - 5};
                };
            }, Window);
        
        
        var SimpleChrome = Inherit(function ()
            {
                this.super(0, 0);
                
                this.Width = '100%';
                this.Height = '100%';
                
                this.Render = function (ctx, time, force)
                {
                    if (force)
                    {
                        var w = ctx.width;
                        var h = ctx.height;
                        ctx.fillStyle = 'lightgray';
                        ctx.fillRect(0, 0, w, h);
                        
                        ctx.strokeStyle = 'black';
                        ctx.beginPath();
                        ctx.moveTo(w - 1, 1);
                        ctx.lineTo(w - 1, h - 1);
                        ctx.lineTo(1, h - 1);
                        ctx.moveTo(2, h - 2);
                        ctx.lineTo(w - 2, h - 2);
                        ctx.lineTo(w - 2, 2);
                        ctx.stroke();
                        
                        ctx.strokeStyle = 'white';
                        ctx.beginPath();
                        ctx.moveTo(w - 1, 0);
                        ctx.lineTo(0, 0);
                        ctx.lineTo(0, h - 1);
                        ctx.moveTo(1, h - 2);
                        ctx.lineTo(1, 1);
                        ctx.lineTo(w - 2, 1);
                        ctx.stroke();
                        
                        ctx.fillStyle = 'white';
                        ctx.fillRect(5, 35, w - 10, h - 40);
                        
                        ctx.fillStyle = 'blue';
                        ctx.fillRect(5, 5, w - 10, 27);
                        //this.Chrome().FoldL('_Render', force, [ctx, x, y, 0, 0, w, h, time]);
                    }
                };
            }, Widget);
        
        
        
        
        
        
        
        var wnd = new BoringWindow(100, 0);
        view.AddWidget(w);
        view.AddWidget(qq);
        wnd.AddChrome(new SimpleChrome());
        wnd.Show();
        wnd.Viewport = view;
        wnd.Width = 500;
        wnd.Height = 500;
        
        wnd._Render(1000);
        
        //w._Render(true, canvas, 0, 0, 0, 0, 400, 400, 10000);
        
        
        
        
        
        </script>
    </body>
</html>

